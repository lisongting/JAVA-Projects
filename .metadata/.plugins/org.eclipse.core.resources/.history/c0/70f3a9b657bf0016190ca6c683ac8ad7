package APPServerTest;

import java.io.ByteArrayOutputStream;
import java.io.DataInputStream;
import java.net.InetAddress;
import java.net.ServerSocket;
import java.net.Socket;
import java.text.SimpleDateFormat;
import java.util.Date;

import org.json.JSONArray;
import org.json.JSONObject;

public class SimpleServer {
	private JSONArray jsonArray;
	public void startServer()throws Exception{
		InetAddress inetAddress =InetAddress.getLocalHost();
		ServerSocket ss = new ServerSocket(30000);
		System.out.println("getHostAddress:"+inetAddress.getHostAddress());
		while (true){
			Socket s  = ss.accept();
			System.out.println("已连接一个客户端");
			//InputStream inputStream =  s.getInputStream();
			//InputStreamReader inputSReader = new InputStreamReader(inputStream,"utf-8");
			//BufferedReader reader = new BufferedReader(inputSReader);
			String ip = s.getInetAddress().toString();
			//String tmp ;
			System.out.println("客户端ip地址是："+ip);
			DataInputStream dis =  new DataInputStream(s.getInputStream());
			ByteArrayOutputStream baos = new ByteArrayOutputStream();
			byte[] by = new byte[4096];
			int hasRead;
			String utfStr;
			while((hasRead = dis.read(by))!=-1){
				baos.write(by,0,hasRead);
			}
			
//			while((utfStr =dis.readUTF())!=null){
//				hasRead = utfStr.length(); 
//				by = utfStr.getBytes();
//				baos.write(by,0,hasRead);
//			}
//			if((utfStr=dis.readUTF())!=null){
//				jsonArray = new JSONArray(utfStr);
//			}
			String strInputstream = new String(baos.toByteArray());
			System.out.println("接受到数据的数据长度是："+strInputstream.length());
			JSONArray jsonArray = new JSONArray(strInputstream);
			int length = jsonArray.length();
			System.out.println("jsonArray长度是："+length);
			for(int i=0;i<length;i++){
				JSONObject jsonObj = null;
				jsonObj = jsonArray.getJSONObject(i);
				String name = (String) jsonObj.getString("name");
				String phone = (String)jsonObj.get("phone");
				System.out.print("姓名："+name+"  电话："+phone);
				System.out.println();
			}
			s.close();
		}
	}
	public static void main(String[] args){
		SimpleServer server = new SimpleServer();
		try{
			server.startServer();
		}catch(Exception e){
			e.printStackTrace();
		}
	}
	public void getTime(){
		Date date = new Date();
		SimpleDateFormat sdf  = new SimpleDateFormat("yyyy--MM--dd--HH--mm--ss");
		//String str = sdf.format(System.currentTimeMillis());
		String str = sdf.format(date);
		System.out.println("时间是："+str);
		
	}
}
